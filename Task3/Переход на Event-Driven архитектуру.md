# Переход на Event-Driven архитектуру

## Проблемы и риски

- запрос от `core-app` к `ins-product-aggregator` выполняется часто и занимает много времени, что отразится на производительности системы при увеличении нагрузки и может приводить к сбоям;

- `ins-comp-settlement` вынужден выполнять избыточные обращения к `ins-product-aggregator`, что приводит к неэффективному использованию ресурсов;

- высокая зависимость сервисов из-за синхронной связи между ними: недоступность `ins-product-aggregator` напрямую влияет на `core-app` и `ins-comp-settlement`, а недоступность `core-app` – на `ins-comp-settlement`.

## Предлагаемое решение

Для решения текущих проблем предлагается внедрить Event-Driven архитектуру для асинхронной репликации данных между сервисами. Предполагается, что в целевой архитектуре вместо синхронных обращений к друг другу сервисы будут публиковать и читать события из соответствующих топиков в брокере событий.

Паттерн Transactional outbox в предлагаемой архитектуре может быть использован в случае, еcли при оформлении страховок сервис `core-app` должен помимо записи в брокер событий также записывать какую-либо информацию об оформленной страховке в `core-db`. Тогда помимо добавления/обновления информации в основной таблице `core-app` должен добавлять в отдельную outbox-таблицу запись о событии, которое необходимо опубликовать. Впоследствии это событие будет асинхронно считываться передатчиком сообщения и записываться в брокер, что значительно снизит вероятность несогласованности данных.
